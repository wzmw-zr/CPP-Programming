# C++编译阶段的属性与静态断言

## 一、编译阶段编程

编译阶段的目标是生成计算机可以识别的机器码。



## 二、属性(attribute)

在C和C++中都有控制编译器的“编译指令”，在GCC中是"\_\_attribute\_\_"，在C++中开始将“编译指令”称为“属性”，可以理解成给变量、函数、类等贴上一个编译阶段的标签，方便编译器识别处理。

属性是使用两队方括号的形式“[[...]]”，方括号中间就是属性标签，用法如下：

```c++
[[noreturn]]
int func(bool flag) {
    throw std::runtime_error("XXX");
}

[[deprecated]] //这个属性是表明下面的变量、函数或者类是废弃的
int old_func();

//当然，为了支持C中的属性，需要使用命名空间gnu
[[gnu::constructor]]

/*
在C中比较常用的几个属性：
deprecated:同C++

unused：用于变量、类型、函数等，表明虽然暂时不用，但是最好保留这，因为将来可能会用

constructor: 函数会在main函数之前执行，效果有点像全局对象的构造函数

destructor:函数会在main函数结束之后执行，类似与全局对象的析构函数

always_inline:要求编译器强制内联函数

hot:标记“热点”函数，要求编译器更加积极优化
*/
```



## 二、静态断言static_assert

静态断言是在编译阶段检测各种条件的断言，static_assert也会和assert一样计算表达式的值，如果是false，就会报错，导致编译失败。

static_assert运行在编译阶段，只能看到编译时的常熟和类型，看不到运行时的变量、指针，内存数据等，所以是“静态的”。

一般而言，静态断言会配合着type_traits使用，这就涉及到了模板元编程。